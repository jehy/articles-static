<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="verify-admitad" content="71b6485389" />
  
  <title>Page 5 | Jehy&#39;s notes</title>
  <meta name="author" content="Jehy">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="Jehy&#39;s notes"/>

  
    <meta property="og:image" content=""/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Jehy&#39;s notes" type="application/atom+xml">
  
<link rel="stylesheet" href="/css/style.css">

  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Jehy&#39;s notes</a></h1>
  <h2><a href="/">Insert 1 into dual</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
      <li><a href="/wishlist">Wishlist</a></li>
    
      <li><a href="/donate">Donate</a></li>
    
      <li><a href="/atom.xml">Subscribe</a></li>
    
      <li><a target="_blank" rel="noopener" href="https://whois.jehy.ru">Contact me</a></li>
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
  <article id="post-2017/06/антипаттерны-для-поиска-соискателей" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2017-06-20T07:00:00.000Z"><a href="/2017/06/антипаттерны-для-поиска-соискателей/">2017-06-20</a></time>
      
      
  
    <h1 class="title"><a href="/2017/06/антипаттерны-для-поиска-соискателей/">Антипаттерны для поиска соискателей</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <p><a target="_blank" rel="noopener" href="https://habr.com/ru/post/331276%7D">Оригинал поста на хабре</a></p>
<p>Привет, Хабр. В качестве тимлида я стою одновременно по обе стороны поиска соискателей - последние пять лет я активно участвую в собеседованиях своих разработчиков, а так же прохожу собеседования. Мне не стыдно писать, что я хожу по собеседованиям - это помогает понять, что сейчас востребовано на рынке, и где у тебя есть пробелы, которые хорошо было бы восполнить. Да и вообще любой специалист должен стремиться к росту, а не стагнации.</p>
<p>И за это время у меня накопилось огромное количество смешных и грустных историй взаимодействия с рекрутерами с обеих сторон, которые я решил систематизировать в общий сборник антипаттернов. Поехали!
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2017/06/антипаттерны-для-поиска-соискателей/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>

<!--  -->



  <article id="post-2017/03/система-для-работы-с-чарниками-для-ролевых-игр" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2017-03-03T07:00:00.000Z"><a href="/2017/03/система-для-работы-с-чарниками-для-ролевых-игр/">2017-03-03</a></time>
      
      
  
    <h1 class="title"><a href="/2017/03/система-для-работы-с-чарниками-для-ролевых-игр/">Система для работы с чарниками для ролевых игр</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <p><a target="_blank" rel="noopener" href="https://habr.com/ru/post/402031%7D">Оригинал поста на хабре</a></p>
<p>Сегодня пятница, так что самое время предаться нашим весёлым странным страстям. Надеюсь, что здесь найдётся аудитория, которая при словосочетании “ролевые игры” представляет себе нечто отличное от девки с плёткой в латексе… Если вы именно о ней и подумали, то дальше читать вам, скорее всего, будет неинтересно.</p>
<p>На самом деле речь идёт про это:
<img src="https://habrastorage.org/files/ef3/838/031/ef383803161744d6bb266fd891908f66.png"/></p>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2017/03/система-для-работы-с-чарниками-для-ролевых-игр/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>

<!--  -->



  <article id="post-2017/02/автоматизированное-тестирование-ботов-для-telegram" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2017-02-28T07:00:00.000Z"><a href="/2017/02/автоматизированное-тестирование-ботов-для-telegram/">2017-02-28</a></time>
      
      
  
    <h1 class="title"><a href="/2017/02/автоматизированное-тестирование-ботов-для-telegram/">Автоматизированное тестирование ботов для Telegram</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <p><a target="_blank" rel="noopener" href="https://habr.com/ru/post/322816%7D">Оригинал поста на хабре</a></p>
<img src="https://habrastorage.org/files/a96/477/6d8/a964776d86b8468186fd9ef7f749fe0f.gif" align="left"/>

<p>Кажется, что время - это река, которую внезапно переклинило, и она решила течь по кругу. Именно такое впечатление складывается на первый взгляд, когда видишь, что вновь стали популярны боты в мессенджерах. Но это впечатление обманчиво. Изменилось очень многое - мощности, которые стоят за ботами, возможность обработки ими мультимедиа информации, наличие информации о пользователях, круг охвата… В общем, это явно не ностальгический тренд, а реально полезная технология, которая будет развиваться и дальше.</p>
<p>Боты становятся всё сложнее, они берут на себя многие функции других каналов. Например, вместо того, чтобы звонить по телефону и слушать по полчаса записанную девушку, которая говорит тебе перейти в тоновый режим и набрать волшебную последовательность символов, всё то же самое можно сделать при помощи бота. И это будет быстрее, удобнее, гибче и дешевле.</p>
<p>Для некоего личного проекта мне захотелось написать бота с довольно сложной ветвящейся логикой (например, это может быть система поддержки или диагностики с глубокой вложенностью). При этом граф данной логики имеет огромное количество разветвлений. В общем, быстро стало очевидно, что без автоматизированного тестирования не обойтись - иначе что-то точно упущу из внимания. И насколько же сильно я удивился, когда узнал, что способа тестировать логику ботов <a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/36891407/use-telegram-client-for-bot-testing-not-bot-api/42489240">просто нет</a>!</p>
<p>Конечно, можно зарегистрировать дополнительного бота для тестирования, но это вариант кривой и некрасивый. Обращение ко внешнему апи во время тестов, заглушка, которая не даст общаться с ботом кому попало, ограничение на скорость отправки сообщений раз в секунду… Если слать сообщение раз в секунду, то граф из каких-то 60 вершин будет тестироваться уже больше минуты! И я уже не говорю о том, что у нас нет никакой возможности смоделировать возросшую нагрузку на бота, при которой он упрётся в ограничение в 30 сообщений в секунду… В общем, я понял, что опять придётся делать что-то своё.</p>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2017/02/автоматизированное-тестирование-ботов-для-telegram/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>

<!--  -->



  <article id="post-2017/02/сложно-о-простом-eslint-в-команде" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2017-02-25T07:00:00.000Z"><a href="/2017/02/сложно-о-простом-eslint-в-команде/">2017-02-25</a></time>
      
      
  
    <h1 class="title"><a href="/2017/02/сложно-о-простом-eslint-в-команде/">Сложно о простом - ESLint в команде</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <p><a target="_blank" rel="noopener" href="https://habr.com/ru/post/322550%7D">Оригинал поста на хабре</a></p>
<p>Маленькое введение. Скорее всего этот пост будет интересен только тем, кто знает, что такое ESLint, но всё же сделаю небольшую вводную - а то сам сильно расстраиваюсь, когда открываю публикацию, и она начинается словами “уже 10 лет мы используем ххх, о котором вы конечно же знаете, а написать мы решили про xxx.yyy, что никто никогда не делал, но наверняка это очень круто”.</p>
<p>Итак, <a target="_blank" rel="noopener" href="http://eslint.org/">ESLint </a>это крутой инструмент, который позволяет проводить анализ качества вашего кода, написанного на любом выбранном стандарте JavaScript. Он приводит код к более-менее единому стилю, помогает избежать глупых ошибок, умеет автоматически исправлять многие из найденных проблем и отлично интегрируется со многими инструментами разработки (привет, Jetbrains, мы любим вас!). Кстати, он, как и другие линтеры, не обязывает вас к одному какому-то конкретному стилю. Наоборот - вы можете выбрать что-то из лучших практик и доработать по своему усмотрению!</p>
<p><img src="https://habrastorage.org/files/4b8/28f/bca/4b828fbca6014be3b83a75421016e8d4.jpg" align="center"/>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2017/02/сложно-о-простом-eslint-в-команде/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>

<!--  -->



  <article id="post-2017/01/безоблачное-мобильное-приложение-—-жизнь-без-google-play" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2017-01-31T07:00:00.000Z"><a href="/2017/01/безоблачное-мобильное-приложение-—-жизнь-без-google-play/">2017-01-31</a></time>
      
      
  
    <h1 class="title"><a href="/2017/01/безоблачное-мобильное-приложение-—-жизнь-без-google-play/">Безоблачное мобильное приложение — жизнь без Google Play</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <p><a target="_blank" rel="noopener" href="https://habr.com/ru/post/320888%7D">Оригинал поста на хабре</a></p>
<p>Чуть раньше мы с вами думали про то, <a target="_blank" rel="noopener" href="https://habrahabr.ru/post/279553/">какие есть альтернативы Google Play</a>, и как можно обходить разные способы блокировки на мобильных приложениях при помощи <a target="_blank" rel="noopener" href="https://habrahabr.ru/post/279267/">Google Compression Proxy</a> и <a target="_blank" rel="noopener" href="https://habrahabr.ru/post/313030/">тора</a>. Сегодня хочется поговорить о том, можно ли запустить и поддерживать полноценное мобильное приложение на Android без помощи какой либо обязательной внешней инфраструктуры. Рассказывать буду на примере всё того же приложения для просмотра рутрекера. Оно ничем особо не примечательно, но очень наглядно.</p>
<img src="https://habrastorage.org/files/4fd/128/c40/4fd128c401c24d33bde65d5b4cbae029.jpg"/>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2017/01/безоблачное-мобильное-приложение-—-жизнь-без-google-play/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>

<!--  -->



  <article id="post-2017/01/экзамен-для-будущих-«русских-хакеров-в-московском-политехе" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2017-01-23T07:00:00.000Z"><a href="/2017/01/экзамен-для-будущих-«русских-хакеров-в-московском-политехе/">2017-01-23</a></time>
      
      
  
    <h1 class="title"><a href="/2017/01/экзамен-для-будущих-«русских-хакеров-в-московском-политехе/">Экзамен для будущих «русских хакеров» в Московском Политехе</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <p><a target="_blank" rel="noopener" href="https://habr.com/ru/post/320210%7D">Оригинал поста на хабре</a></p>
<p>И снова здравствуйте. Обычно я пишу статьи в качестве разработчика, но сегодня хочется поделиться опытом проведения экзамена по информационной безопасности в <a target="_blank" rel="noopener" href="http://mospolytech.ru/">Московском Политехе</a>. По-моему получилось довольно интересно. Задание даже может быть полезным начинающим тестировщикам и пентестерам. Но вначале я немного расскажу про то, как проходили занятия в течении семестра - чтобы было понятно, как мы дошли до жизни такой.</p>
<img src="https://habrastorage.org/files/7d0/898/a05/7d0898a050d643239e872b81750f8bbd.jpg" align="center"/>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2017/01/экзамен-для-будущих-«русских-хакеров-в-московском-политехе/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>

<!--  -->



  <article id="post-2016/12/покемоны-замерзли-как-реальная-реальность-влияет-на-дополненную-и-на-мобильные-приложения-в-целом" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2016-12-15T07:00:00.000Z"><a href="/2016/12/покемоны-замерзли-как-реальная-реальность-влияет-на-дополненную-и-на-мобильные-приложения-в-целом/">2016-12-15</a></time>
      
      
  
    <h1 class="title"><a href="/2016/12/покемоны-замерзли-как-реальная-реальность-влияет-на-дополненную-и-на-мобильные-приложения-в-целом/">Покемоны замерзли. Как реальная реальность влияет на дополненную и на мобильные приложения в целом</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <p><a target="_blank" rel="noopener" href="https://habr.com/ru/post/400089%7D">Оригинал поста на хабре</a></p>
<p>Основной хайп по покемонам уже прошёл, однако они являются отличным примером, на котором можно показывать и обсуждать всякие интересные вещи - например, <a target="_blank" rel="noopener" href="https://habrahabr.ru/post/307974/">вопросы безопасности</a> мобильных приложений. Или принципы того, как можно оседлать волну хайпа и раскрутить свой бренд (очень крутой <a target="_blank" rel="noopener" href="http://www.slideshare.net/DrJungAgency/ss-65925328">доклад</a> был у Вячеслава Грабчака на эту тему). А сегодня мы поговорим про то, как реальная реальность (простите за нарочитый каламбур) влияет на дополненную. И что вы можете с этим сделать.
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2016/12/покемоны-замерзли-как-реальная-реальность-влияет-на-дополненную-и-на-мобильные-приложения-в-целом/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>

<!--  -->



  <article id="post-2016/12/как-на-самом-деле-пишут-софт-в-2016-году" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2016-12-02T07:00:00.000Z"><a href="/2016/12/как-на-самом-деле-пишут-софт-в-2016-году/">2016-12-02</a></time>
      
      
  
    <h1 class="title"><a href="/2016/12/как-на-самом-деле-пишут-софт-в-2016-году/">Как на самом деле пишут софт в 2016 году</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <p><a target="_blank" rel="noopener" href="https://habr.com/ru/post/399747%7D">Оригинал поста на хабре</a></p>
<p>Многие годы софтварные компании скрывали от нас это. Читайте скорее, пока не удалили, и распространяйте как можно шире.</p>
<p>Вы до сих пор думаете, что огромные корпорации обладают большим штатом разработчиков, которые пишут им программный код руками? Наивно. На дворе 2016 год, и правила полностью изменились. Сейчас легко доступны чудовищные вычислительные мощности, о которых 10 лет назад нельзя было и заикнуться. Ваш телефон мощнее, чем вычислительные модули, которые ставили на космические корабли. А человеческое время стоит страшно дорого - в особенности время квалифицированных программистов, которыми, словно пчёлами, якобы набиты офисы технологических гигантов.
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2016/12/как-на-самом-деле-пишут-софт-в-2016-году/#more" class="more-link">Read More</a>
          </div>
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>

<!--  -->



  <article id="post-2016/10/лёгкая-интеграция-tor-в-android-приложение-на-примере-клиента-для-рутрекера" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2016-10-18T07:00:00.000Z"><a href="/2016/10/лёгкая-интеграция-tor-в-android-приложение-на-примере-клиента-для-рутрекера/">2016-10-18</a></time>
      
      
  
    <h1 class="title"><a href="/2016/10/лёгкая-интеграция-tor-в-android-приложение-на-примере-клиента-для-рутрекера/">Лёгкая интеграция tor в android приложение на примере клиента для рутрекера</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <p><a target="_blank" rel="noopener" href="https://habr.com/ru/post/313030%7D">Оригинал поста на хабре</a></p>
<p>Мне давно было интересно, можно ли легко добавить проксирование через тор в Android приложение. Вроде бы довольно очевидная задача, плюс тор браузеры уже под эту платформу давно есть… Но есть много задач, которые сложнее, чем кажутся. Для нетерпеливых сразу скажу - да, можно, и получается довольно легко, быстро и классно. В особенности если не копать с нуля, а воспользоваться моими наработками.</p>
<p>Для примера я буду использовать приложение для работы с рутрекером - никто не любит код, который работает со сферический конём в вакууме. Раньше это приложение обходило блокировку <a target="_blank" rel="noopener" href="https://habrahabr.ru/post/279267/">при помощи Google Compression Proxy</a> - но увы - то ли рутрекер, то ли гугл выпилил возможность авторизации с этой проксёй. Сразу скажу, что, конечно, есть всякие впны и прочее, что вы используете для лёгкого обхода блокировки и просмотра сериальчиков. Но речь здесь идёт не про это. Как вы понимаете, тор можно использовать в мобильном приложении для огромного количества вещей - например, для доступа к веб сайтам в .onion или для реализации особо безопасного мессенджера.
<cut></p>
<h1>Как подключить библиотеку для работы с Тором</h1>
<h2>Как собрать с нуля</h2>
Если вас не интересует сборка с нуля, то сразу перейдите к следующему заголовку.

<p>Итак, что у нас есть на эту тему из готового инструментария. Есть особый репозиторий от неких ребят под предводительством Microsoft (ссылка в подвале). Вроде бы у них всё работало - но качество и механизм сборки просто ужасают. А ещё репозиторий устарел на два года. И скомпилированный версии библиотеки там нет, есть только довольно стрёмные инструкции по тому, как собрать её самостоятельно (в стиле - “я делал так, не знаю почему, но без этого ничего не работало”). Впрочем, имеющихся инструкций вполне достаточно для того, чтобы обновить код до актуального состояния и исправить все странные косяки.</p>
<ol><li>Клонируем себе этот репозиторий.

</li>
<li>Обновляем там компонент, который отвечает за управление тором - jtorctl. Они использовали форк основного репозитория с правками от briar, но эти правки уже включены в основной репозиторий, так что лучше взять с основного. Можно подключать из maven репозитория, но я такие вещи обычно забираю исходниками - можно сразу посмотреть, прогнать анализ и править на лету баги - проект-то довольно сырой, несмотря на возраст.

</li>
<li>Обновляем geoip и geoip6 — базы данных блоков IP-адресов с привязкой к географическому положению каждого блока для версий IPv4 и IPv6 соответственно. Для этого скачиваем на сайте тора windows expert bundle.

</li>
<li>Обновляем сам тор (то есть нативную библиотеку). Стандартной общедоступной нет (ну или я плохо искал) - так что идём к ребятам, которые разрабатывают тор и тор браузер под андроид (Orbot и Orfox), берём последний релиз их Orbot и вынимаем оттуда библиотеку. Тор там довольно свежий, что приятно.

</li>
<li>Правим руками всё, что перестало компилироваться в нашем проекте. Несколько функций в зависимых библиотеках изменились, но в целом всё интуитивно понятно и поправимо за 5 минут.

</li>
<li>Следуя рекомендациям ридми нашего проекта, создаём локальные мавен репозитории и строим из кучи кусков наш проект. Кстати, обратите внимание, что билд скрипт настолько кривой, что в одном месте включает в себя предыдущий релиз себя же. Жуть. Так что рекомендую переписать его заново, простым и понятным языком, чтобы получить на выходе обыкновенную библиотеку aar.
</li>
</ol>
<h2>Как собрать из моих наработок</h2>
Пункты 1-6 я уже сделал за вас, так что просто соберите библиотеку из моего репозитория, или скачайте её в секции релизов. Ссылка будет в “подвале” поста. Однако обращаю внимание, что правильным будет проверить код и библиотеки на соответствие оригинальным и отсутствие закладок. Не стоит такие вещи добавлять вслепую в свои приложения.

<h1>Как перестать волноваться и начать проксировать через тор</h1>
Сначала нужно включить тор:

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">int totalSecondsPerTorStartup = 4 * 60;</span><br><span class="line">int totalTriesPerTorStartup = 5;</span><br><span class="line">try &#123;</span><br><span class="line">  boolean ok = onionProxyManager.startWithRepeat(totalSecondsPerTorStartup, totalTriesPerTorStartup);</span><br><span class="line">  if (!ok)</span><br><span class="line">    Log.e(&quot;TorTest&quot;, &quot;Couldn&#x27;t start Tor!&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  catch (InterruptedException | IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Затем подождать, пока он подцепится:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">while (!onionProxyManager.isRunning())</span><br><span class="line">  Thread.sleep(90);</span><br></pre></td></tr></table></figure>
<p>Если всё прошло успешно - ура, он слушает у нас localhost на каком-то случайном порту:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Log.v(&quot;My App&quot;, &quot;Tor initialized on port &quot; + onionProxyManager.getIPv4LocalHostSocksPort());</span><br></pre></td></tr></table></figure>
<p>Но это пока не всё. У нас теперь есть тор, который слушает порт в качестве Socks4a прокси. Однако далеко не все стандартные библиотеки умеют работать с Socks4a. Там из соображений анонимности требуется, чтобы резолв хоста происходил на прокси, а не ранее. Не знаю, какие из стандартных библиотек это умеют, и у меня был код, написанный с Apache HttpComponents. Я уже <a target="_blank" rel="noopener" href="https://habrahabr.ru/post/308522/">писал ранее</a>, почему их можно использовать, да и данный пост не про то. Если вы хотите, то можете реализовать то же самое на любой другой библиотеке.</p>
<p>Итак, для использования httpComponents нам нужно переписать ConnectionSocketFactory и SSLConnectionSocketFactory.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">public class MySSLConnectionSocketFactory extends SSLConnectionSocketFactory &#123;</span><br><span class="line"></span><br><span class="line">    public MySSLConnectionSocketFactory(final SSLContext sslContext) &#123;</span><br><span class="line">        super(sslContext);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Socket createSocket(final HttpContext context) throws IOException &#123;</span><br><span class="line">        return new Socket();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Socket connectSocket(</span><br><span class="line">            int connectTimeout,</span><br><span class="line">            Socket socket,</span><br><span class="line">            final HttpHost host,</span><br><span class="line">            final InetSocketAddress remoteAddress,</span><br><span class="line">            final InetSocketAddress localAddress,</span><br><span class="line">            final HttpContext context) throws IOException &#123;</span><br><span class="line">        Args.notNull(host, &quot;HTTP host&quot;);</span><br><span class="line">        Args.notNull(remoteAddress, &quot;Remote address&quot;);</span><br><span class="line">        InetSocketAddress socksaddr = (InetSocketAddress) context.getAttribute(&quot;socks.address&quot;);</span><br><span class="line">        socket = new Socket();</span><br><span class="line">        connectTimeout = 100000;</span><br><span class="line">        socket.setSoTimeout(connectTimeout);</span><br><span class="line">        socket.connect(new InetSocketAddress(socksaddr.getHostName(), socksaddr.getPort()), connectTimeout);</span><br><span class="line">        DataOutputStream outputStream = new DataOutputStream(socket.getOutputStream());</span><br><span class="line">        outputStream.write((byte) 0x04);</span><br><span class="line">        outputStream.write((byte) 0x01);</span><br><span class="line">        outputStream.writeShort((short) host.getPort());</span><br><span class="line">        outputStream.writeInt(0x01);</span><br><span class="line">        outputStream.write((byte) 0x00);</span><br><span class="line">        outputStream.write(host.getHostName().getBytes());</span><br><span class="line">        outputStream.write((byte) 0x00);</span><br><span class="line"></span><br><span class="line">        DataInputStream inputStream = new DataInputStream(socket.getInputStream());</span><br><span class="line">        if (inputStream.readByte() != (byte) 0x00 || inputStream.readByte() != (byte) 0x5a) &#123;</span><br><span class="line">            throw new IOException(&quot;SOCKS4a connect failed&quot;);</span><br><span class="line">        &#125; else</span><br><span class="line">            Log.v(&quot;SSLConnectionSF&quot;, &quot;SOCKS4a connect ok!&quot;);</span><br><span class="line">        inputStream.readShort();</span><br><span class="line">        inputStream.readInt();</span><br><span class="line"></span><br><span class="line">        SSLConnectionSocketFactory sslSocketFactory = SSLConnectionSocketFactory.getSocketFactory();</span><br><span class="line">        SSLSocket sslSocket = (SSLSocket) sslSocketFactory.createLayeredSocket(socket, host.getHostName(), host.getPort(), context);</span><br><span class="line">        prepareSocket(sslSocket);</span><br><span class="line">        return sslSocket;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">public class MyConnectionSocketFactory implements ConnectionSocketFactory &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Socket createSocket(final HttpContext context) throws IOException &#123;</span><br><span class="line">        return new Socket();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Socket connectSocket(</span><br><span class="line">            int connectTimeout,</span><br><span class="line">            Socket socket,</span><br><span class="line">            final HttpHost host,</span><br><span class="line">            final InetSocketAddress remoteAddress,</span><br><span class="line">            final InetSocketAddress localAddress,</span><br><span class="line">            final HttpContext context) throws IOException, ConnectTimeoutException &#123;</span><br><span class="line"></span><br><span class="line">        InetSocketAddress socksaddr = (InetSocketAddress) context.getAttribute(&quot;socks.address&quot;);</span><br><span class="line">        socket = new Socket();</span><br><span class="line">        connectTimeout = 100000;</span><br><span class="line">        socket.setSoTimeout(connectTimeout);</span><br><span class="line">        socket.connect(new InetSocketAddress(socksaddr.getHostName(), socksaddr.getPort()), connectTimeout);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        DataOutputStream outputStream = new DataOutputStream(socket.getOutputStream());</span><br><span class="line">        outputStream.write((byte) 0x04);</span><br><span class="line">        outputStream.write((byte) 0x01);</span><br><span class="line">        outputStream.writeShort((short) host.getPort());</span><br><span class="line">        outputStream.writeInt(0x01);</span><br><span class="line">        outputStream.write((byte) 0x00);</span><br><span class="line">        outputStream.write(host.getHostName().getBytes());</span><br><span class="line">        outputStream.write((byte) 0x00);</span><br><span class="line"></span><br><span class="line">        DataInputStream inputStream = new DataInputStream(socket.getInputStream());</span><br><span class="line">        if (inputStream.readByte() != (byte) 0x00 || inputStream.readByte() != (byte) 0x5a) &#123;</span><br><span class="line">            throw new IOException(&quot;SOCKS4a connect failed&quot;);</span><br><span class="line">        &#125; else</span><br><span class="line">            Log.v(&quot;SSLConnectionSF&quot;, &quot;SOCKS4a connect ok!&quot;);</span><br><span class="line">        inputStream.readShort();</span><br><span class="line">        inputStream.readInt();</span><br><span class="line">        return socket;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Использовать эти фабрики легко и просто. Для этого нужно создать HttpClient, который использует эти библиотеки:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public HttpClient getNewHttpClient() &#123;</span><br><span class="line"></span><br><span class="line">     Registry&lt;ConnectionSocketFactory&gt; reg = RegistryBuilder.&lt;ConnectionSocketFactory&gt;create()</span><br><span class="line">             .register(&quot;http&quot;, new MyConnectionSocketFactory())</span><br><span class="line">             .register(&quot;https&quot;, new MySSLConnectionSocketFactory(SSLContexts.createSystemDefault()))</span><br><span class="line">             .build();</span><br><span class="line">     PoolingHttpClientConnectionManager cm = new PoolingHttpClientConnectionManager(reg);</span><br><span class="line">     return HttpClients.custom()</span><br><span class="line">             .setConnectionManager(cm)</span><br><span class="line">             .build();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>И указать ему наш прокси сервер:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">HttpClient cli = getNewHttpClient();</span><br><span class="line"> int port = onionProxyManager.getIPv4LocalHostSocksPort();</span><br><span class="line"> InetSocketAddress socksaddr = new InetSocketAddress(&quot;127.0.0.1&quot;, port);</span><br><span class="line"> HttpClientContext context = HttpClientContext.create();</span><br><span class="line"> context.setAttribute(&quot;socks.address&quot;, socksaddr);</span><br></pre></td></tr></table></figure>
<p>Всё, теперь мы можем использовать тор так же, как если бы делали обыкновенные запросы. Более того, мы можем так же обращаться и к веб сайтам .onion.</p>
<h1>Результат</h1>
Получившийся код я использовал в своём приложении для рутрекера. Да, инициализация тора занимает около 20 секунд, и страницы грузятся не так быстро - но зато мы гарантированно проходим блокировку. А все ресурсы, которые не блокированы, подгружаются через обычное соединение. Можно было бы остальные ресурсы пропускать через Google Compression Proxy, но многие жаловались, что у них заблокирован этот прокси - так что я не стал этого делать. Конечно, в приложении можно было бы ещё много всего сделать - например, кэшировать статику на телефоне для экономии трафика и более быстрой работы - но это не столь критично, да и приложение я писал скорее для примера.

<h1>Заключение</h1>
Тор на андроиде - классная и удобная штука, которая достаточно работает, и её действительно можно использовать в своих приложениях. Кстати да, есть гораздо более лёгкий способ это делать - просто требовать установки Orbot, который сам поднимет вам тор. Но мне не нравятся зависимости одних приложений от других, да и 3 лишних мегабайта не так критичны в размере приложения. Так что если кому понравилось моё решение - используйте, делайте пулл реквесты, и да пребудет с вами свобода.

<h1>Ссылки:</h1>
<ol>
	<li><a target="_blank" rel="noopener" href="https://github.com/thaliproject/Tor_Onion_Proxy_Library">Исходная библиотека</a>;</li>
	<li><a target="_blank" rel="noopener" href="https://github.com/jehy/Tor-Onion-Proxy-Library">Моя сборка библиотеки</a>;</li>
	<li><a target="_blank" rel="noopener" href="https://github.com/jehy/rutracker-free">Приложение для рутрекера</a>;</li>
	<li><a target="_blank" rel="noopener" href="https://guardianproject.info">Guardian Project</a> - ребята, которым мы обязаны наличием нативной тор библиотеки.</li>
</ol>
<img src="https://habrastorage.org/files/195/45e/e8d/19545ee8d9e144c4860db4f6490d804a.jpg" align="center"/>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>

<!--  -->



  <article id="post-2016/08/о-чём-молчит-google-и-почему-вам-стоит-использовать-apache-httpcomponents-в-android" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2016-08-25T07:00:00.000Z"><a href="/2016/08/о-чём-молчит-google-и-почему-вам-стоит-использовать-apache-httpcomponents-в-android/">2016-08-25</a></time>
      
      
  
    <h1 class="title"><a href="/2016/08/о-чём-молчит-google-и-почему-вам-стоит-использовать-apache-httpcomponents-в-android/">О чём молчит Google и почему вам стоит использовать Apache HttpComponents в Android</a></h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <p><a target="_blank" rel="noopener" href="https://habr.com/ru/post/308522%7D">Оригинал поста на хабре</a></p>
<p>Эту статью нужно было публиковать гораздо раньше (почти на шесть лет), сэкономив тем самым Android разработчикам огромное количество месяцев бессмысленной разработки - но увы, не всегда есть на это время.</p>
<h1>Введение</h1>
Если вы разрабатываете под Android, то наверняка сталкивались с тем, что открываете вы своё приложение, которое отлично работало несколько лет, и тут внезапно оказывается, что Apache httpComponents стали deprecated, и их не рекомендуется использовать. Сначала давайте разберём, что же произошло, а потом сделаем выводы, что делать.<habracut/>

<h2>Что произошло</h2>
Слишком далеко закапываться я не стал, однако много интересных вещей можно получить из рассылки org.apache.hc.dev и джиры Apache. Например, факт что:

<blockquote>Android включал в себя старый pre-beta релиз библиотеки</blockquote>
Более того, на протяжении всей истории версия библиотеки не менялась, и если включаете у себя apache legacy, то это всё та же pre-beta.

<p>Подтверждение можно прочитать <a target="_blank" rel="noopener" href="https://hc.apache.org/httpcomponents-client-4.3.x/android-port.html">тут</a>.</p>
<p>“Подтверждение на английском:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Google Android 1.0 was released with a pre-BETA snapshot of Apache HttpClient. To coincide with the first Android release Apache HttpClient 4.0 APIs had to be frozen prematurely, while many of interfaces and internal structures were still not fully worked out. As Apache HttpClient 4.0 was maturing the project was expecting Google to incorporate the latest code improvements into their code tree. Unfortunately it did not happen. Version of Apache HttpClient shipped with Android has effectively become a fork. Eventually Google decided to discontinue further development of their fork while refusing to upgrade to the stock version of Apache HttpClient citing compatibility concerns as a reason for such decision. As a result those Android developers who would like to continue using Apache HttpClient APIs on Android cannot take advantage of newer features, performance improvements and bug fixes.</span><br></pre></td></tr></table></figure>

<blockquote>Google просто забил на проблему</blockquote>
Разработчики из Apache активно работали над библиотекой, но назначенные им менеджеры Google не отвечали месяцами, менялись, а в конце концов сказали, что это не приоритетная задача, пользователям хватает старой версии, да и вообще надо выкинуть эту библиотеку. В подтверждение - немного из упомянутого мной листа рассылки (работа началась в 2008 году, а в 2010 внезапно проявился новый менеджер):

<p>Новый менеджер признаёт, что задаче не уделяют внимания… Ну и ладно.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Jesse Wilson commented on HTTPCLIENT-898:</span><br><span class="line">I&#x27;m Bob&#x27;s successor on the Android team. If you&#x27;ve got questions about our use of the HTTP client code, I&#x27;ll do my best to answer &#x27;em. I regret that we haven&#x27;t given this code much attention lately; that said I&#x27;m happy that it hasn&#x27;t really needed it.</span><br></pre></td></tr></table></figure>

<p>Тогда же прозвенел первый тревожный звоночек:</p>
<p>Знаете, спустя два года мы решили, что ничего не надо делать.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">I&#x27;m quite sorry that Android included an unreleased rev of Apache HTTP client, and I suspect we&#x27;ll be paying for that mistake for quite a while.</span><br><span class="line"></span><br><span class="line">Because of the strict compatibility requirements of our platform, we will be unable to make forwards-incompatible API changes to the HTTP code. Unlike your desktop and serverside users, including the API as a part of the core platform significantly reduces our ability to make API changes.</span><br><span class="line"></span><br><span class="line">These days we aren&#x27;t spending much time on the HTTP client code. Our users seem to be mostly satisfied with the ancient version in the SDK, and have been directing their complaints elsewhere (crypto, locales, XML...).</span><br><span class="line"></span><br><span class="line">That said, we do want to figure out a long term strategy for an HTTP client API that will work for both us and the Apache HTTP client team. We&#x27;re considering a variety of options...</span><br><span class="line"></span><br><span class="line">  - Discouraging our users from using the built-in Apache HTTP client,    preferring the JDK&#x27;s own URLConnection classes. Whether this is feasible depends mostly on whether the new APIs in Java 6 (which we&#x27;re working on)   will satisfy the use cases that Apache HTTP client has covered for years.</span><br><span class="line"></span><br><span class="line">  - Replacing the Apache HTTP client API with a 3rd API in a &quot;com.google&quot;  or &quot;android.&quot; package. Such an API would likely be based on parts of your own code, but with a more limited API.</span><br><span class="line"></span><br><span class="line">  - Tidying up the version of Apache HTTP that we&#x27;re already stuck with. This includes deprecating APIs that shouldn&#x27;t have ever been exposed as  public, and possibly filling in any gaps using newer code from your project.</span><br><span class="line"></span><br><span class="line">But none of this work is particularly urgent since we&#x27;re actively fighting fires in other areas of the core libraries.</span><br></pre></td></tr></table></figure>
<p>Они не могут производит изменения в коде существующей библиотеки из-за несовместимостей? Oh rly? А если вынесут это в свой отдельный пакет на основе кода Apache, то внезапно смогут? Вообще, breaking changes в Android это отдельная тема, выходящая за рамки данной статьи, но чего стоит только ограничение разрешений приложений в шестёрке… При этом ребята из Apache активно старались предоставить максимальную совместимость, и было готовы сделать для этого что угодно. Но увы.</p>
<p>Ребят, у нас мало времени, мы взяли вашу разработку и забили на неё, не беспокойте нас по пустякам.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">I explained on several earlier occasions that Android doesn&#x27;t allow binary incompatibilities of any kind (not my rule). I understand that the HttpClient team is more tolerant of binary incompatibilities. While I&#x27;m not saying it would be impossible to make these changes in Android, I am saying that it would take a lot of convincing (and time), it would annoy other people who are time-constrained and who have higher priorities, and it could likely fail anyway.</span><br></pre></td></tr></table></figure>

<h2>Финал</h2>
А дальше библиотеку просто без всяких адекватных объяснений выпилили с официальной рекомендацией использовать HttpUrlConnection. Вот <a target="_blank" rel="noopener" href="http://android-developers.blogspot.ru/2011/09/androids-http-clients.html">хотя бы что-то</a>, отдалённо похожее на объяснение ситуации от Джесси Вилсона, который был на то время в Dalvik team (к слову, он же и был вторым менеджером Google по связям с Apache. Запомните это имя).

<p>В его статье вы можете увидеть, что среди преимуществ он видит:</p>
<ul>
	<li>Кеширование (которое, если надо, реализуется где угодно)</li>
	<li>Малый вес библиотеки (да, но сомнительный аргумент)</li>
	<li>Компрессия, которая сохраняет батарейку и ускоряет загрузку (да, но при желании мы можем использовать Google Compression Proxy и через Apache HttpComponents как обычный прокси)</li>
</ul>
Крайне сомнительные объяснения. Если вы сейчас сидите в шапочке из фольги, то рациональным доводом будет то, что гугл таким образом решил втихую заставить пользователей гонять весь свой трафик через свой прокси…
<b>UPD</b>. Как мне справедливо указали, под компрессией имеется в виду не использование GCP, а использование стандартного gzip... Который у Apache есть уже много-много лет. Так что тем более странно.

<p>К сожалению, большинство разработчиков слепо верят Google и сразу считают, что библиотека Apache “плохая”, и нужно бежать выкидывать её из своего кода.</p>
<p>Разработчики из Apache прокомментировали это кратко:</p>
<blockquote>Google has used the project when it suited their goals and screwed us afterwards. There is nothing we can do about it.</blockquote>

<h2>Эпилог c OkHttp</h2>
Если вы разрабатываете под Android, то наверняка видели рекомендации заменять Apache HttpComponents ныне популярной библиотекой OkHttp от Square.

<p>А вы всё ещё помните милого парня Джесси Вилсона из Dalvik team? А вы знаете, что сейчас <a target="_blank" rel="noopener" href="https://github.com/swankjesse">он работает в Square</a>? И именно он является создателем OkHttp? Более того, вы знате, что OkHttp начинался как форк куска AOSP (Android Open Source Project), который в свою очередь брал свой код из Apache Harmony?</p>
<p>Так что это и есть по сути создание форка Apache с последующим выкидыванием оригинала из обращения (второй вариант из озвученных ранее Джесси в общении с Apache). Звучит довольно гнусно, не правда ли? Единственное что непонятно - была ли это инициатива Google или самого Джесси. Но поступил он крайне некрасиво, выкинув конкурентов с помощью Google и придя весь в белом со своим решением.</p>
<h1>И что же?</h1>
Давайте разберёмся, какие есть варианты того, как жить дальше.

<p><b>1. Использовать HttpUrlConnection</b>
Рекомендованный подход Google. Действительно имеет смысл, если у вас простое приложение. Но не дай бог вам попробовать сделать что-то не совсем тривиальное. В моей практике таких случая было два - когда я пытался использовать SSL прокси и когда хотел обратиться к некоему айпишнику со своим именем хоста. Обе задачи при помощи HttpUrlConnection реализовать невозможно.</p>
<p><b>2. Использовать другие продвинутые альтернативы</b>
Например, тот же OkHttp. Сам его не пробовал, но говорят, что библиотека хорошая. Однако, вы потратите много времени на переписывание хорошего готового имеющегося кода (если у вас уже есть приложение). Ну и касательно именно OkHttp - я бы не стал использовать столь неприятно пахнущий форк.</p>
<p><b>3. Использовать legacy библиотеку</b>
Да, вы можете продолжать использовать всю ту же древнюю бету, что и раньше. Но зачем? Как быстрое затыкание дырки это решение неплохое, а если нет… То конечно нет. Обидно, что именно такой ответ является наиболее популярным решением на том же stack overflow - люди просто не понимают, что они используют версию библиотеки от 2008 года.</p>
<p><b>4. Использовать последние версии Apache HttpComponents</b>
В плюсах имеем то, что мы продолжаем использовать всё тот же код, не тратя время на переписывание и на изучение новой библиотеки и её багов. Более того, код написанный на HttpComponents будет у вас работать где угодно. Библиотека чудовищно мощная и позволяет вам сделать действительно что угодно.
Вопрос - как её подключать?
Если просто брать и подставлять в gradle, то выйдет конфликт классов с этой самой древней версией.
В релизе 4.3 разработчики apache предлагали использовать специальные постфиксы “HC4” в классах для избегания конфликтов, но работало это как-то очень плохо.
Зато к релизу 4.5 они уже рекомендуют другой, единственно логичный выход - использовать перепакованную под другим пространством классов библиотеку, собранную неким товарищем на гитхабе (ссылка ниже). Там, правда, на самом деле версия 4.4, а не 4.5 - но это не так принципиально. А если вас волнует, что вы используете собранную непонятно кем библиотеку (хотя она довольно популярна), то вы всегда можете собрать её сами из исходников. На данный момент я считаю это наиболее правильным выходом из сложившейся дурной ситуации (и сам делаю именно так).</p>
<h2>Что дальше?</h2>
Заметок по использованию пятой версии библиотеки на Android пока что нету - возможно, это объясняется тем, что она пока ещё в альфа версии. Или просто в Apache решили больше не иметь дела с Google и Android. Впрочем, даже если так - всегда найдутся энтузиасты, которые смогут корректно перепаковать последнюю версию. А работать с ней - сплошное удовольствие.

<h2>Ссылки</h2>
<ol>
	<li><a target="_blank" rel="noopener" href="https://github.com/smarek/httpclient-android">Репозиторий</a> с перепакованной версией httpComponents;</li>
	<li><a target="_blank" rel="noopener" href="https://hc.apache.org/httpcomponents-client-4.5.x/android-port.html">Заметки</a> о релизе 4.5, где рекомендуют использовать этот репозиторий;</li>
	<li>Интересные <a target="_blank" rel="noopener" href="http://markmail.org/search/?q=order%3Adate-backward+list%3Aorg.apache.hc.dev+from%3ABob%2BLee+from%3AJesse%2BWilson#query:order%3Adate-backward%20list%3Aorg.apache.hc.dev%20from%3ABob%2BLee%20from%3AJesse%2BWilson+page:1+mid:2l7zed626lunw63s+state:results">фрагменты переписки</a> ребят из Apache и Google;</li>
	<li>Любопытные задачи с комментариями в джире Apache - <a target="_blank" rel="noopener" href="https://issues.apache.org/jira/browse/HTTPCLIENT-1632">раз</a>  и <a target="_blank" rel="noopener" href="https://issues.apache.org/jira/browse/HTTPCLIENT-898">два</a>.</li>
</ol>
В процессе написания статьи я общался на эту тему с разработчиком из Apache, который подтвердил мои предположения, но от греха подальше упоминать его здесь не буду.

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>

<!--  -->





    <nav id="page-nav">
        
        <a class="extend prev" rel="prev" href="/page/4/">&lt;&lt; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/30/">30</a><a class="extend next" rel="next" href="/page/6/">Next &gt;&gt;</a>
    </nav>

</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="as_sitesearch" value="articles.jehy.ru">
  </form>
</div>


  

  
<div class="widget tagcloud">
  <h3 class="title">Tag Cloud</h3>
  <div class="entry">
    <a href="/tags/MS-SQL/" style="font-size: 10px;">MS SQL</a> <a href="/tags/Oracle/" style="font-size: 11.25px;">Oracle</a> <a href="/tags/PHP/" style="font-size: 10.63px;">PHP</a> <a href="/tags/RHEL/" style="font-size: 10px;">RHEL</a> <a href="/tags/SAP/" style="font-size: 10px;">SAP</a> <a href="/tags/android/" style="font-size: 10.63px;">android</a> <a href="/tags/applet/" style="font-size: 11.88px;">applet</a> <a href="/tags/arduino/" style="font-size: 11.25px;">arduino</a> <a href="/tags/buddypress/" style="font-size: 10px;">buddypress</a> <a href="/tags/codesigning/" style="font-size: 10.63px;">codesigning</a> <a href="/tags/dev/" style="font-size: 15.63px;">dev</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/esphome/" style="font-size: 10.63px;">esphome</a> <a href="/tags/fun/" style="font-size: 15px;">fun</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/habr/" style="font-size: 19.38px;">habr</a> <a href="/tags/home-assistant/" style="font-size: 14.38px;">home assistant</a> <a href="/tags/java/" style="font-size: 11.88px;">java</a> <a href="/tags/jvm/" style="font-size: 10px;">jvm</a> <a href="/tags/livejournal/" style="font-size: 10px;">livejournal</a> <a href="/tags/medium/" style="font-size: 10.63px;">medium</a> <a href="/tags/mta/" style="font-size: 10px;">mta</a> <a href="/tags/node/" style="font-size: 10px;">node</a> <a href="/tags/openid/" style="font-size: 10.63px;">openid</a> <a href="/tags/skype/" style="font-size: 10px;">skype</a> <a href="/tags/webstart/" style="font-size: 11.88px;">webstart</a> <a href="/tags/wiki/" style="font-size: 11.88px;">wiki</a> <a href="/tags/wod/" style="font-size: 10px;">wod</a> <a href="/tags/wordpress/" style="font-size: 16.25px;">wordpress</a> <a href="/tags/wordpress-mu/" style="font-size: 10px;">wordpress mu</a> <a href="/tags/yum/" style="font-size: 10px;">yum</a> <a href="/tags/%D0%B0%D0%BD%D0%B8%D0%BC%D0%B5/" style="font-size: 11.88px;">аниме</a> <a href="/tags/%D0%B1%D0%B5%D0%B3/" style="font-size: 10px;">бег</a> <a href="/tags/%D0%B8%D0%BD%D0%BA%D0%B2%D0%B8%D0%B7%D0%B8%D1%86%D0%B8%D1%8F/" style="font-size: 10.63px;">инквизиция</a> <a href="/tags/%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D0%BD%D0%B5%D1%82%D1%8B/" style="font-size: 11.25px;">интернеты</a> <a href="/tags/%D0%B8%D1%81%D1%82%D0%BE%D1%80%D0%B8%D0%B8/" style="font-size: 20px;">истории</a> <a href="/tags/%D0%BA%D0%B0%D1%80%D1%82%D0%B8%D0%BD%D0%BA%D0%B8/" style="font-size: 13.75px;">картинки</a> <a href="/tags/%D0%BA%D0%B8%D0%BD%D0%BE/" style="font-size: 15px;">кино</a> <a href="/tags/%D0%BA%D0%BD%D0%B8%D0%B6%D0%BD%D0%BE%D0%B5/" style="font-size: 17.5px;">книжное</a> <a href="/tags/%D0%BA%D0%BF%D0%BA/" style="font-size: 10.63px;">кпк</a> <a href="/tags/%D0%BB%D0%B8%D0%BD%D1%83%D0%BA%D1%81/" style="font-size: 10px;">линукс</a> <a href="/tags/%D0%BC%D0%B0%D0%BD%D0%B3%D0%B0/" style="font-size: 10.63px;">манга</a> <a href="/tags/%D0%BC%D1%83%D0%B7%D1%8B%D0%BA%D0%B0/" style="font-size: 18.13px;">музыка</a> <a href="/tags/%D0%BC%D1%8B%D1%81%D0%BB%D0%B8/" style="font-size: 16.88px;">мысли</a> <a href="/tags/%D0%BF%D0%B5%D1%80%D0%B5%D0%B2%D0%BE%D0%B4%D1%8B/" style="font-size: 15px;">переводы</a> <a href="/tags/%D0%BF%D0%BE-%D0%B6%D0%B8%D0%B7%D0%BD%D0%B8/" style="font-size: 10.63px;">по жизни</a> <a href="/tags/%D0%BF%D0%BE%D0%BB%D0%B8%D1%82%D0%B8%D0%BA%D0%B0/" style="font-size: 10.63px;">политика</a> <a href="/tags/%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%B0/" style="font-size: 10.63px;">работа</a> <a href="/tags/%D1%80%D0%BE%D0%BB%D0%B5%D0%B2%D1%8B%D0%B5-%D0%B8%D0%B3%D1%80%D1%8B/" style="font-size: 13.13px;">ролевые игры</a> <a href="/tags/%D1%82%D0%B0%D1%80%D0%BE/" style="font-size: 11.88px;">таро</a> <a href="/tags/%D1%83%D0%BC%D0%BD%D1%8B%D0%B9-%D0%B4%D0%BE%D0%BC/" style="font-size: 14.38px;">умный дом</a> <a href="/tags/%D1%83%D1%87%D0%B5%D0%B1%D0%BD%D0%BE%D0%B5/" style="font-size: 12.5px;">учебное</a> <a href="/tags/%D1%85%D0%B8%D0%BA%D0%BA%D0%B8/" style="font-size: 10px;">хикки</a> <a href="/tags/%D1%86%D0%B5%D1%80%D0%BA%D0%BE%D0%B2%D1%8C/" style="font-size: 10.63px;">церковь</a> <a href="/tags/%D1%86%D0%B8%D1%82%D0%B0%D1%82%D1%8B/" style="font-size: 18.75px;">цитаты</a>
  </div>
</div>


  
<div class="widget tag">
  <h3 class="title">Recent Posts</h3>
  <ul class="entry">
    
      <li>
        <a href="/2025/02/умный-дом-на-канале-яндекса/">Мой умный дом на канале яндекса</a>
      </li>
    
      <li>
        <a href="/2024/09/отчёт-по-трясине/">Отчёт по «Трясине» от МГ «... И Животноводство».</a>
      </li>
    
      <li>
        <a href="/2024/07/self-hosted-для-домашнего-сервера/">Self Hosted для домашнего сервера</a>
      </li>
    
      <li>
        <a href="/2024/07/докер-контейнеры-и-прикладная-некромантия/">Докер контейнеры и прикладная некромантия</a>
      </li>
    
      <li>
        <a href="/2024/05/отчёт-по-эйре/">Отчёт по «Книге Эйре»</a>
      </li>
    
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><!--<div class="alignleft">
  
  &copy; 2025 Jehy
  
</div>-->
<div class="clearfix"></div>
</footer>
  
<script src="/js/jquery-3.4.1.min.js"></script>


<script src="/js/jquery.imagesloaded.min.js"></script>


<script src="/js/gallery.js"></script>






<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script src="/fancybox/jquery.fancybox.pack.js"></script>

<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>
